<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fromm AI</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Inter', sans-serif;
            background-color: #FAF0E6; /* Cream background for the whole page */
            color: #333333;
            overscroll-behavior-y: none;
        }
        .tab-button {
            transition: background-color 0.3s, color 0.3s;
        }
        .tab-button.active {
            background-color: #42B2FC; /* New Accent Color */
            color: white;
        }
        .tab-button:not(.active):hover {
            background-color: #E0F2F7;
        }
        /* Card style for My Account section specifically */
        #myAccount .card {
            background-color: #FFFFFF; /* White background for My Account card */
        }
        /* General card style for other sections */
        .card {
            background-color: white; /* Default white for other cards */
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
            margin-bottom: 20px;
        }
        .btn-primary {
            background-color: #42B2FC; /* New Accent Color */
            color: white;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            transition: background-color 0.3s;
            font-size: 1rem;
        }
        .btn-primary:hover {
            background-color: #2F9AE8; /* Darker shade of new accent */
        }
        .btn-secondary {
            background-color: #E0E0E0;
            color: #333333;
            padding: 10px 15px;
            border-radius: 8px;
            font-weight: 500;
            transition: background-color 0.3s;
        }
        .btn-secondary:hover {
            background-color: #D0D0D0;
        }
        .concern-tag {
            cursor: pointer;
            transition: background-color 0.3s, color 0.3s, border-color 0.3s;
            border: 1px solid #D1D5DB;
            padding: 8px 12px;
            border-radius: 20px;
            font-size: 0.875rem;
            margin: 4px;
            display: inline-block;
        }
        .concern-tag.selected {
            background-color: #42B2FC; /* New Accent Color */
            color: white;
            border-color: #42B2FC; /* New Accent Color */
        }
        .concern-tag:not(.selected):hover {
            border-color: #42B2FC; /* New Accent Color for hover border */
            background-color: #f0f7ff; /* Lighter shade for hover background */
        }
        select {
            -webkit-appearance: none;
            -moz-appearance: none;
            appearance: none;
            background-image: url("data:image/svg+xml;charset=UTF-8,%3csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='none' stroke='%236B7280' stroke-width='2' stroke-linecap='round' stroke-linejoin='round'%3e%3cpolyline points='6 9 12 15 18 9'%3e%3c/polyline%3e%3c/svg%3e");
            background-repeat: no-repeat;
            background-position: right 0.75rem center;
            background-size: 1.2em 1.2em;
            padding-right: 2.5rem; /* Make space for arrow */
        }

        /* Custom scrollbar for webkit browsers */
        ::-webkit-scrollbar {
            width: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb {
            background: #A0D2DB; /* Keeping scrollbar subtle */
            border-radius: 10px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #87CEEB;
        }
        main {
            padding-bottom: 80px;
        }
    </style>
</head>
<body class="antialiased">
    <div id="app" class="min-h-screen flex flex-col">
        <header class="p-4 shadow-md bg-white sticky top-0 z-10">
            <div class="container mx-auto flex justify-between items-center">
                <h1 class="text-xl font-bold text-[#42B2FC]" id="appName">Fromm AI</h1>
                <div class="flex items-center space-x-2">
                    <select id="languageSwitcher" class="p-2 border border-gray-300 rounded-md text-sm focus:ring-[#42B2FC] focus:border-[#42B2FC]">
                        <option value="en">English</option>
                        <option value="ru">Русский</option>
                        <option value="fr">Français</option>
                        <option value="es">Español</option>
                    </select>
                </div>
            </div>
        </header>

        <main class="flex-grow container mx-auto p-4 overflow-y-auto">
            <section id="myAccount" class="hidden">
                <div class="card"> <h2 class="text-xl font-semibold mb-6" data-translate="myAccountTitle">My Account</h2>

                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 mb-4" data-translate="topicsToDiscussTitle">The topics I want to discuss</h3>

                        <div class="mb-6">
                            <h4 class="text-md font-semibold text-gray-700 mb-3" data-translate="subCategoryStateOfMind">My state of mind</h4>
                            <div id="concernsStateOfMind" class="flex flex-wrap -m-1">
                                </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-md font-semibold text-gray-700 mb-3" data-translate="subCategoryRelationship">Relationship</h4>
                            <div id="concernsRelationship" class="flex flex-wrap -m-1">
                                </div>
                        </div>

                        <div class="mb-6">
                            <h4 class="text-md font-semibold text-gray-700 mb-3" data-translate="subCategoryWorkStudy">Work, study</h4>
                            <div id="concernsWorkStudy" class="flex flex-wrap -m-1">
                                </div>
                        </div>
                    </div>

                    <div class="mb-8">
                        <h3 class="text-lg font-bold text-gray-800 mb-4" data-translate="whereFromTitle">Where are you from?</h3>
                        <div class="relative">
                             <select id="userRegionSelect" class="w-full p-3 border border-gray-300 rounded-md focus:ring-[#42B2FC] focus:border-[#42B2FC] bg-white">
                                <option value="" data-translate="chooseRegionPlaceholder">Choose a region</option>
                                <option value="latin_america" data-translate="regionLatinAmerica">Latin America</option>
                                <option value="north_america" data-translate="regionNorthAmerica">North America</option>
                                <option value="europe" data-translate="regionEurope">Europe</option>
                                <option value="scandinavia" data-translate="regionScandinavia">Scandinavia</option>
                                <option value="middle_east" data-translate="regionMiddleEast">Middle East</option>
                                <option value="india" data-translate="regionIndia">India</option>
                             </select>
                        </div>
                    </div>

                    <button id="saveConcerns" class="btn-primary w-full" data-translate="saveButton">Save</button>
                </div>

                 <div class="card mt-6"> <h3 class="text-lg font-semibold mb-2" data-translate="disclaimerTitle">Important Disclaimer</h3>
                    <p class="text-sm text-gray-600" data-translate="disclaimerText">
                        Fromm AI is a digital assistant based on artificial intelligence. AI psychologists are not real people or medical professionals. This application is not intended for diagnosing or treating mental disorders. In case of serious problems or an emergency, please contact a qualified specialist or a helpline.
                    </p>
                </div>
            </section>

            <section id="myAIMentor" class="">
                <h2 class="text-2xl font-semibold mb-6 text-center" data-translate="aiMentorTitle">Choose Your AI-Mentor</h2>
                <div id="aiMentorCardContainer" class="relative">
                    </div>
                <div id="aiMentorNavigation" class="flex justify-center space-x-4 mt-6">
                    <button id="prevMentor" class="btn-secondary" data-translate="prevMentorButton">Previous</button>
                    <button id="nextMentor" class="btn-secondary" data-translate="nextMentorButton">Next</button>
                </div>
            </section>

            <section id="progress" class="hidden">
                 <h2 class="text-2xl font-semibold mb-6 text-center" data-translate="progressTitle">Your Progress</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-2" data-translate="chatsCompleted">Chats Completed</h3>
                        <p class="text-3xl font-bold text-[#42B2FC]">5 <span class="text-sm font-normal text-gray-500">(mock)</span></p>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-2" data-translate="feedbackScore">Average Feedback</h3>
                        <p class="text-3xl font-bold text-[#42B2FC]">4.5/5 <span class="text-sm font-normal text-gray-500">(mock)</span></p>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-2" data-translate="regularityPoints">Regularity Points</h3>
                        <p class="text-3xl font-bold text-[#42B2FC]">120 <span class="text-sm font-normal text-gray-500">(mock)</span></p>
                    </div>
                    <div class="card">
                        <h3 class="text-lg font-semibold mb-2" data-translate="badgesEarned">Badges Earned</h3>
                        <div class="flex space-x-2 mt-2">
                            <span class="text-2xl" title="Новичок">🌟</span>
                            <span class="text-2xl" title="Постоянный посетитель">📅</span>
                            <span class="text-2xl" title="Исследователь себя">🧠</span>
                        </div>
                    </div>
                </div>
                <div class="card mt-6">
                    <h3 class="text-lg font-semibold mb-2">Progress Bar <span class="text-sm font-normal text-gray-500">(mock)</span></h3>
                    <div class="w-full bg-gray-200 rounded-full h-4">
                        <div class="bg-[#42B2FC] h-4 rounded-full" style="width: 60%;"></div>
                    </div>
                    <p class="text-sm text-gray-500 mt-1 text-center">60% to next level</p>
                </div>
            </section>
        </main>

        <footer class="fixed bottom-0 left-0 right-0 bg-white border-t border-gray-200 shadow-t-lg">
            <nav class="container mx-auto flex justify-around p-1">
                <button data-section="myAIMentor" class="tab-button flex-1 p-3 text-center text-sm rounded-md" data-translate="navMentor">My AI-Mentor</button>
                <button data-section="myAccount" class="tab-button flex-1 p-3 text-center text-sm rounded-md" data-translate="navAccount">My Account</button>
                <button data-section="progress" class="tab-button flex-1 p-3 text-center text-sm rounded-md" data-translate="navProgress">Progress</button>
            </nav>
        </footer>
    </div>

    <script>
        // Initialize Telegram Web App
        if (window.Telegram && window.Telegram.WebApp) {
            window.Telegram.WebApp.ready();
            window.Telegram.WebApp.expand();
            // Set background color for the WebApp view itself if supported
            // window.Telegram.WebApp.setBackgroundColor('#FAF0E6'); // This might override body bg
        }

        const translations = {
            en: {
                appName: "Fromm AI",
                navProgress: "Progress",
                navMentor: "My AI-Mentor",
                navAccount: "My Account",
                myAccountTitle: "My Account",
                topicsToDiscussTitle: "The topics I want to discuss",
                subCategoryStateOfMind: "My state of mind",
                topicStress: "Stress",
                topicUnstableSelfEsteem: "Unstable self-esteem",
                topicIrritability: "Irritability",
                topicConcentrationProblems: "Concentration problems",
                topicEmotionalDependency: "Emotional dependency",
                subCategoryRelationship: "Relationship",
                topicWithPartner: "With partner",
                topicInGeneralWithOthers: "In general, with others",
                topicWithParents: "With parents",
                subCategoryWorkStudy: "Work, study",
                topicLackOfMotivation: "Lack of motivation",
                topicBurnOut: "Burn-out",
                topicDontKnowWhatToDo: "«I don't know what I want to do»",
                topicProcrastination: "Procrastination",
                topicLackOfPurpose: "Lack of purpose",
                topicChangeLossOfJob: "Change, loss of job",
                whereFromTitle: "Where are you from?",
                chooseRegionPlaceholder: "Choose a region",
                regionLatinAmerica: "Latin America",
                regionNorthAmerica: "North America",
                regionEurope: "Europe",
                regionScandinavia: "Scandinavia",
                regionMiddleEast: "Middle East",
                regionIndia: "India",
                saveButton: "Save",
                saveButtonFeedback: "Your preferences have been saved.", // For popup
                saveButtonFeedbackTitle: "Saved", // For popup title
                aiMentorTitle: "Choose Your AI-Mentor",
                startChatButton: "Start Chat in Telegram",
                nextMentorButton: "Next",
                prevMentorButton: "Previous",
                originLabel: "Origin",
                languagesLabel: "Languages",
                approachLabel: "Therapeutic Approach",
                progressTitle: "Your Progress",
                chatsCompleted: "Chats Completed",
                feedbackScore: "Average Feedback",
                regularityPoints: "Regularity Points",
                badgesEarned: "Badges Earned",
                disclaimerTitle: "Important Disclaimer",
                disclaimerText: "Fromm AI is a digital assistant based on artificial intelligence. AI psychologists are not real people or medical professionals. This application is not intended for diagnosing or treating mental disorders. In case of serious problems or an emergency, please contact a qualified specialist or a helpline.",
                originIndia: "India",
                originFrance: "France",
                originSpain: "Spain",
                originGermany: "Germany",
                approachCBT: "Cognitive Behavioral",
                approachHumanistic: "Humanistic",
                approachACT: "ACT (Acceptance and Commitment Therapy)",
                approachPsychodynamic: "Psychodynamic",
                anyaDescription: "Focusing on understanding thoughts and behaviors to foster positive change.",
                leoDescription: "Emphasizing personal growth, self-actualization, and the client's capacity for self-direction.",
                sofiaDescription: "Helping you accept your thoughts and feelings and commit to actions that enrich your life.",
                maxDescription: "Exploring unconscious patterns and past experiences to understand present difficulties."
            },
            ru: {
                appName: "Fromm AI",
                navProgress: "Прогресс",
                navMentor: "Мой ИИ-Наставник",
                navAccount: "Мой Аккаунт",
                myAccountTitle: "Мой Аккаунт",
                topicsToDiscussTitle: "Темы, которые я хочу обсудить",
                subCategoryStateOfMind: "Моё состояние",
                topicStress: "Стресс",
                topicUnstableSelfEsteem: "Нестабильная самооценка",
                topicIrritability: "Раздражительность",
                topicConcentrationProblems: "Проблемы с концентрацией",
                topicEmotionalDependency: "Эмоциональная зависимость",
                subCategoryRelationship: "Отношения",
                topicWithPartner: "С партнером",
                topicInGeneralWithOthers: "В целом с другими",
                topicWithParents: "С родителями",
                subCategoryWorkStudy: "Работа, учеба",
                topicLackOfMotivation: "Отсутствие мотивации",
                topicBurnOut: "Выгорание",
                topicDontKnowWhatToDo: "«Не знаю, чем хочу заниматься»",
                topicProcrastination: "Прокрастинация",
                topicLackOfPurpose: "Отсутствие цели",
                topicChangeLossOfJob: "Смена, потеря работы",
                whereFromTitle: "Откуда вы?",
                chooseRegionPlaceholder: "Выберите регион",
                regionLatinAmerica: "Латинская Америка",
                regionNorthAmerica: "Северная Америка",
                regionEurope: "Европа",
                regionScandinavia: "Скандинавия",
                regionMiddleEast: "Ближний Восток",
                regionIndia: "Индия",
                saveButton: "Сохранить",
                saveButtonFeedback: "Ваши данные сохранены.",
                saveButtonFeedbackTitle: "Сохранено",
                aiMentorTitle: "Выберите ИИ-Наставника",
                startChatButton: "Начать чат в Telegram",
                nextMentorButton: "Следующий",
                prevMentorButton: "Предыдущий",
                originLabel: "Происхождение",
                languagesLabel: "Языки",
                approachLabel: "Терапевтический подход",
                progressTitle: "Ваш Прогресс",
                chatsCompleted: "Завершено чатов",
                feedbackScore: "Средний балл отзывов",
                regularityPoints: "Баллы за регулярность",
                badgesEarned: "Полученные значки",
                disclaimerTitle: "Важное уведомление",
                disclaimerText: "Fromm AI — это цифровой помощник на базе искусственного интеллекта. ИИ-психологи не являются настоящими людьми или медицинскими специалистами. Это приложение не предназначено для диагностики или лечения психических расстройств. В случае серьезных проблем или экстренной ситуации, пожалуйста, обратитесь к квалифицированному специалисту или на горячую линию помощи.",
                originIndia: "Индия",
                originFrance: "Франция",
                originSpain: "Испания",
                originGermany: "Германия",
                approachCBT: "Когнитивно-поведенческая",
                approachHumanistic: "Гуманистическая",
                approachACT: "ACT (Терапия принятия и ответственности)",
                approachPsychodynamic: "Психодинамическая",
                anyaDescription: "Фокусируется на понимании мыслей и поведения для содействия позитивным изменениям.",
                leoDescription: "Подчеркивает личностный рост, самоактуализацию и способность клиента к самоопределению.",
                sofiaDescription: "Помогает принять ваши мысли и чувства и посвятить себя действиям, обогащающим вашу жизнь.",
                maxDescription: "Исследует бессознательные паттерны и прошлый опыт для понимания текущих трудностей."
            },
            fr: {
                appName: "Fromm AI",
                navProgress: "Progrès",
                navMentor: "Mon IA-Mentor",
                navAccount: "Mon Compte",
                myAccountTitle: "Mon Compte",
                topicsToDiscussTitle: "Les sujets que je veux aborder",
                subCategoryStateOfMind: "Mon état d'esprit",
                topicStress: "Stress",
                topicUnstableSelfEsteem: "Estime de soi instable",
                topicIrritability: "Irritabilité",
                topicConcentrationProblems: "Problèmes de concentration",
                topicEmotionalDependency: "Dépendance émotionnelle",
                subCategoryRelationship: "Relation",
                topicWithPartner: "Avec partenaire",
                topicInGeneralWithOthers: "En général, avec les autres",
                topicWithParents: "Avec les parents",
                subCategoryWorkStudy: "Travail, études",
                topicLackOfMotivation: "Manque de motivation",
                topicBurnOut: "Épuisement professionnel",
                topicDontKnowWhatToDo: "«Je ne sais pas ce que je veux faire»",
                topicProcrastination: "Procrastination",
                topicLackOfPurpose: "Manque de but",
                topicChangeLossOfJob: "Changement, perte d'emploi",
                whereFromTitle: "D'où venez-vous ?",
                chooseRegionPlaceholder: "Choisissez une région",
                regionLatinAmerica: "Amérique Latine",
                regionNorthAmerica: "Amérique du Nord",
                regionEurope: "Europe",
                regionScandinavia: "Scandinavie",
                regionMiddleEast: "Moyen-Orient",
                regionIndia: "Inde",
                saveButton: "Enregistrer",
                saveButtonFeedback: "Vos préférences ont été enregistrées.",
                saveButtonFeedbackTitle: "Enregistré",
                aiMentorTitle: "Choisissez Votre IA-Mentor",
                startChatButton: "Démarrer le chat dans Telegram",
                nextMentorButton: "Suivant",
                prevMentorButton: "Précédent",
                originLabel: "Origine",
                languagesLabel: "Langues",
                approachLabel: "Approche thérapeutique",
                progressTitle: "Vos Progrès",
                chatsCompleted: "Discussions terminées",
                feedbackScore: "Commentaires moyens",
                regularityPoints: "Points de régularité",
                badgesEarned: "Badges gagnés",
                disclaimerTitle: "Avis Important",
                disclaimerText: "Fromm AI est un assistant numérique basé sur l'intelligence artificielle. Les psychologues IA ne sont pas de vraies personnes ni des professionnels de la santé. Cette application n'est pas destinée à diagnostiquer ou à traiter des troubles mentaux. En cas de problèmes graves ou d'urgence, veuillez contacter un spécialiste qualifié ou une ligne d'assistance.",
                originIndia: "Inde",
                originFrance: "France",
                originSpain: "Espagne",
                originGermany: "Allemagne",
                approachCBT: "Cognitivo-comportementale",
                approachHumanistic: "Humaniste",
                approachACT: "ACT (Thérapie d'acceptation et d'engagement)",
                approachPsychodynamic: "Psychodynamique",
                anyaDescription: "Se concentre sur la compréhension des pensées et des comportements pour favoriser un changement positif.",
                leoDescription: "Met l'accent sur la croissance personnelle, l'auto-actualisation et la capacité du client à s'autodiriger.",
                sofiaDescription: "Vous aide à accepter vos pensées et vos sentiments et à vous engager dans des actions qui enrichissent votre vie.",
                maxDescription: "Explore les schémas inconscients et les expériences passées pour comprendre les difficultés actuelles."
            },
            es: {
                appName: "Fromm AI",
                navProgress: "Progreso",
                navMentor: "Mi IA-Mentor",
                navAccount: "Mi Cuenta",
                myAccountTitle: "Mi Cuenta",
                topicsToDiscussTitle: "Los temas que quiero discutir",
                subCategoryStateOfMind: "Mi estado de ánimo",
                topicStress: "Estrés",
                topicUnstableSelfEsteem: "Autoestima inestable",
                topicIrritability: "Irritabilidad",
                topicConcentrationProblems: "Problemas de concentración",
                topicEmotionalDependency: "Dependencia emocional",
                subCategoryRelationship: "Relación",
                topicWithPartner: "Con pareja",
                topicInGeneralWithOthers: "En general, con otros",
                topicWithParents: "Con los padres",
                subCategoryWorkStudy: "Trabajo, estudio",
                topicLackOfMotivation: "Falta de motivación",
                topicBurnOut: "Agotamiento",
                topicDontKnowWhatToDo: "«No sé qué quiero hacer»",
                topicProcrastination: "Procrastinación",
                topicLackOfPurpose: "Falta de propósito",
                topicChangeLossOfJob: "Cambio, pérdida de empleo",
                whereFromTitle: "¿De dónde eres?",
                chooseRegionPlaceholder: "Elige una región",
                regionLatinAmerica: "América Latina",
                regionNorthAmerica: "América del Norte",
                regionEurope: "Europa",
                regionScandinavia: "Escandinavia",
                regionMiddleEast: "Medio Oriente",
                regionIndia: "India",
                saveButton: "Guardar",
                saveButtonFeedback: "Tus preferencias han sido guardadas.",
                saveButtonFeedbackTitle: "Guardado",
                aiMentorTitle: "Elige Tu IA-Mentor",
                startChatButton: "Iniciar chat en Telegram",
                nextMentorButton: "Siguiente",
                prevMentorButton: "Anterior",
                originLabel: "Origen",
                languagesLabel: "Idiomas",
                approachLabel: "Enfoque terapéutico",
                progressTitle: "Tu Progreso",
                chatsCompleted: "Chats completados",
                feedbackScore: "Comentarios promedio",
                regularityPoints: "Puntos de regularidad",
                badgesEarned: "Insignias ganadas",
                disclaimerTitle: "Aviso Importante",
                disclaimerText: "Fromm AI es un asistente digital basado en inteligencia artificial. Los psicólogos de IA no son personas reales ni profesionales médicos. Esta aplicación no está destinada a diagnosticar o tratar trastornos mentales. En caso de problemas graves o una emergencia, comuníquese con un especialista calificado o una línea de ayuda.",
                originIndia: "India",
                originFrance: "Francia",
                originSpain: "España",
                originGermany: "Alemania",
                approachCBT: "Cognitivo-conductual",
                approachHumanistic: "Humanista",
                approachACT: "ACT (Terapia de Aceptación y Compromiso)",
                approachPsychodynamic: "Psicodinámico",
                anyaDescription: "Se enfoca en comprender pensamientos y comportamientos para fomentar un cambio positivo.",
                leoDescription: "Enfatiza el crecimiento personal, la autorrealización y la capacidad del cliente para la autodirección.",
                sofiaDescription: "Te ayuda a aceptar tus pensamientos y sentimientos y a comprometerte con acciones que enriquecen tu vida.",
                maxDescription: "Explora patrones inconscientes y experiencias pasadas para comprender las dificultades actuales."
            }
        };

        let currentLanguage = 'en';
        let currentMentorIndex = 0;
        let userConcerns = [];
        let userRegion = '';

        const concernCategories = {
            stateOfMind: {
                elementId: 'concernsStateOfMind',
                items: [
                    { id: 'stress', key: 'topicStress' },
                    { id: 'unstableSelfEsteem', key: 'topicUnstableSelfEsteem' },
                    { id: 'irritability', key: 'topicIrritability' },
                    { id: 'concentrationProblems', key: 'topicConcentrationProblems' },
                    { id: 'emotionalDependency', key: 'topicEmotionalDependency' },
                ]
            },
            relationship: {
                elementId: 'concernsRelationship',
                items: [
                    { id: 'withPartner', key: 'topicWithPartner' },
                    { id: 'inGeneralWithOthers', key: 'topicInGeneralWithOthers' },
                    { id: 'withParents', key: 'topicWithParents' },
                ]
            },
            workStudy: {
                elementId: 'concernsWorkStudy',
                items: [
                    { id: 'lackOfMotivation', key: 'topicLackOfMotivation' },
                    { id: 'burnOut', key: 'topicBurnOut' },
                    { id: 'dontKnowWhatToDo', key: 'topicDontKnowWhatToDo' },
                    { id: 'procrastination', key: 'topicProcrastination' },
                    { id: 'lackOfPurpose', key: 'topicLackOfPurpose' },
                    { id: 'changeLossOfJob', key: 'topicChangeLossOfJob' },
                ]
            }
        };

        const aiPersonalities = [
          {
            id: 'anya_sharma',
            name: 'Dr. Anya Sharma',
            originKey: 'originIndia',
            languages: ['English', 'Hindi'],
            approachKey: 'approachCBT',
            descriptionKey: 'anyaDescription',
            telegramUsername: 'AnyaSharmaAIBot_bot',
            avatar: 'https://placehold.co/120x120/A0D2DB/333333?text=AS'
          },
          {
            id: 'leo_moreau',
            name: 'Léo Moreau',
            originKey: 'originFrance',
            languages: ['Français', 'English'],
            approachKey: 'approachHumanistic',
            descriptionKey: 'leoDescription',
            telegramUsername: 'LeoMoreauAIBot_bot',
            avatar: 'https://placehold.co/120x120/87CEEB/FFFFFF?text=LM'
          },
          {
            id: 'sofia_castillo',
            name: 'Sofía Castillo',
            originKey: 'originSpain',
            languages: ['Español', 'English'],
            approachKey: 'approachACT',
            descriptionKey: 'sofiaDescription',
            telegramUsername: 'SofiaCastilloAIBot_bot',
            avatar: 'https://placehold.co/120x120/DBA0A0/FFFFFF?text=SC'
          },
          {
            id: 'max_schmidt',
            name: 'Dr. Max Schmidt',
            originKey: 'originGermany',
            languages: ['Deutsch', 'English'],
            approachKey: 'approachPsychodynamic',
            descriptionKey: 'maxDescription',
            telegramUsername: 'MaxSchmidtAIBot_bot',
            avatar: 'https://placehold.co/120x120/D3D3D3/333333?text=MS'
          }
        ];

        function translateUI() {
            document.querySelectorAll('[data-translate]').forEach(el => {
                const key = el.getAttribute('data-translate');
                const translation = translations[currentLanguage]?.[key];
                if (translation) {
                    // Preserve child elements if the element is a container for options (like select)
                    if (el.tagName === 'SELECT' && el.options.length > 0 && key === 'chooseRegionPlaceholder') {
                         // Only translate the placeholder option if it's the first one and has an empty value
                        if (el.options[0].value === "") {
                            el.options[0].textContent = translation;
                        }
                    } else {
                         el.innerHTML = translation;
                    }
                }
            });
            renderMyAccountTopics();
            renderAIMentorCard();
        }

        document.getElementById('languageSwitcher').addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            localStorage.setItem('frommAiLang', currentLanguage);
            translateUI();
        });

        const sections = ['myAccount', 'myAIMentor', 'progress'];
        const navButtons = document.querySelectorAll('.tab-button');

        function showSection(sectionId) {
            sections.forEach(id => {
                document.getElementById(id).classList.add('hidden');
            });
            document.getElementById(sectionId).classList.remove('hidden');
            navButtons.forEach(button => {
                button.classList.toggle('active', button.dataset.section === sectionId);
            });
            localStorage.setItem('frommAiActiveSection', sectionId);
        }

        navButtons.forEach(button => {
            button.addEventListener('click', () => {
                showSection(button.dataset.section);
            });
        });

        const saveConcernsButton = document.getElementById('saveConcerns');
        const userRegionSelect = document.getElementById('userRegionSelect');

        function renderMyAccountTopics() {
            for (const categoryKey in concernCategories) {
                const category = concernCategories[categoryKey];
                const container = document.getElementById(category.elementId);
                if (!container) continue;
                container.innerHTML = '';
                category.items.forEach(concern => {
                    const button = document.createElement('button');
                    button.classList.add('concern-tag');
                    button.textContent = translations[currentLanguage]?.[concern.key] || concern.key.replace(/([A-Z])/g, ' $1').trim();
                    button.dataset.concernId = concern.id;
                    if (userConcerns.includes(concern.id)) {
                        button.classList.add('selected');
                    }
                    button.addEventListener('click', () => {
                        toggleConcern(concern.id);
                        button.classList.toggle('selected');
                    });
                    container.appendChild(button);
                });
            }
             // Ensure the placeholder for the region select is also translated
            const placeholderOption = userRegionSelect.querySelector('option[value=""]');
            if (placeholderOption) {
                placeholderOption.textContent = translations[currentLanguage]?.chooseRegionPlaceholder || "Choose a region";
            }
        }

        function toggleConcern(concernId) {
            const index = userConcerns.indexOf(concernId);
            if (index > -1) {
                userConcerns.splice(index, 1);
            } else {
                userConcerns.push(concernId);
            }
        }

        saveConcernsButton.addEventListener('click', () => {
            userRegion = userRegionSelect.value; // Get value from select
            localStorage.setItem('frommAiUserConcerns', JSON.stringify(userConcerns));
            localStorage.setItem('frommAiUserRegion', userRegion);

            const savedMessage = translations[currentLanguage]?.saveButtonFeedback || 'Data saved!';
            const savedTitle = translations[currentLanguage]?.saveButtonFeedbackTitle || 'Saved';

            if (window.Telegram && window.Telegram.WebApp) {
                window.Telegram.WebApp.showPopup({
                    title: savedTitle,
                    message: savedMessage,
                    buttons: [{type: 'ok'}]
                });
            } else {
                alert(savedMessage);
            }
        });

        const mentorCardContainer = document.getElementById('aiMentorCardContainer');
        const prevMentorButton = document.getElementById('prevMentor');
        const nextMentorButton = document.getElementById('nextMentor');

        function renderAIMentorCard() {
            if (!aiPersonalities || aiPersonalities.length === 0) {
                mentorCardContainer.innerHTML = `<p class="text-center text-gray-500">No mentors available at the moment.</p>`;
                return;
            }
            const mentor = aiPersonalities[currentMentorIndex];
            if (!mentor) return;

            const lang = currentLanguage;
            const description = translations[lang]?.[mentor.descriptionKey] || mentor.descriptionKey || 'Description not available.';


            mentorCardContainer.innerHTML = `
                <div class="card text-center p-6 transform transition-all duration-300 ease-in-out hover:scale-105">
                    <img src="${mentor.avatar}" alt="${mentor.name}" class="w-24 h-24 rounded-full mx-auto mb-4 border-4 border-[#42B2FC]" onerror="this.src='https://placehold.co/120x120/E0E0E0/333333?text=Mentor'; this.onerror=null;">
                    <h3 class="text-2xl font-bold mb-1">${mentor.name}</h3>
                    <p class="text-sm text-gray-500 mb-3">
                        <strong>${translations[lang]?.originLabel || 'Origin'}:</strong>
                        <span>${translations[lang]?.[mentor.originKey] || mentor.originKey}</span>
                    </p>
                    <div class="mb-3">
                        <strong class="block text-sm font-medium mb-1">${translations[lang]?.languagesLabel || 'Languages'}:</strong>
                        <div class="flex flex-wrap justify-center gap-2">
                            ${mentor.languages.map(l => `<span class="bg-gray-200 text-gray-700 px-2 py-1 text-xs rounded-full">${l}</span>`).join('')}
                        </div>
                    </div>
                    <div class="mb-4">
                        <strong class="block text-sm font-medium mb-1">${translations[lang]?.approachLabel || 'Therapeutic Approach'}:</strong>
                        <p class="text-sm text-[#42B2FC] font-semibold">${translations[lang]?.[mentor.approachKey] || mentor.approachKey}</p>
                    </div>
                    <p class="text-sm text-gray-600 mb-6 min-h-[40px]">${description}</p>
                    <button id="startChat" class="btn-primary w-full">${translations[lang]?.startChatButton || 'Start Chat in Telegram'}</button>
                </div>
            `;

            document.getElementById('startChat').addEventListener('click', () => {
                let startParams = [];
                if (userConcerns.length > 0) {
                    startParams.push(`concerns_${userConcerns.join('_')}`);
                }
                if (userRegion) {
                    startParams.push(`region_${encodeURIComponent(userRegion)}`);
                }
                const telegramLink = `https://t.me/${mentor.telegramUsername}?start=${startParams.join('&')}`;

                if (window.Telegram && window.Telegram.WebApp) {
                    window.Telegram.WebApp.openTelegramLink(telegramLink);
                } else {
                    window.open(telegramLink, '_blank');
                    console.log('Opening Telegram link:', telegramLink);
                }
                demoFetchToAPI(mentor);
            });
        }

        prevMentorButton.addEventListener('click', () => {
            currentMentorIndex = (currentMentorIndex - 1 + aiPersonalities.length) % aiPersonalities.length;
            renderAIMentorCard();
        });

        nextMentorButton.addEventListener('click', () => {
            currentMentorIndex = (currentMentorIndex + 1) % aiPersonalities.length;
            renderAIMentorCard();
        });

        async function demoFetchToAPI(mentor) {
            const mockApiEndpoint = 'https://jsonplaceholder.typicode.com/posts';
            const telegramUser = (window.Telegram?.WebApp?.initDataUnsafe?.user)
                                 ? window.Telegram.WebApp.initDataUnsafe.user
                                 : { id: 'testUser123', first_name: 'Demo' };
            console.log("Preparing to send demo API request for mentor:", mentor.name, "and user:", telegramUser.id);
            console.log("User concerns for prompt:", userConcerns);
            console.log("User region for prompt:", userRegion);
            try {
                const response = await fetch(mockApiEndpoint, {
                    method: 'POST',
                    body: JSON.stringify({
                        title: `AI Mentor Request: ${mentor.name}`,
                        body: `User ID: ${telegramUser.id}, User Name: ${telegramUser.first_name}, Selected Mentor: ${mentor.name}, Approach: ${translations[currentLanguage]?.[mentor.approachKey]}, Concerns: ${userConcerns.join(', ')}, Region: ${userRegion}`,
                        userId: telegramUser.id,
                    }),
                    headers: { 'Content-type': 'application/json; charset=UTF-8' },
                });
                if (!response.ok) throw new Error(`Network response was not ok: ${response.statusText}`);
                const data = await response.json();
                console.log('Demo API Response:', data);
            } catch (error) {
                console.error('Demo API fetch error:', error);
            }
        }

        function initializeApp() {
            const savedLang = localStorage.getItem('frommAiLang');
            if (savedLang && translations[savedLang]) {
                currentLanguage = savedLang;
                document.getElementById('languageSwitcher').value = savedLang;
            }

            const savedConcerns = localStorage.getItem('frommAiUserConcerns');
            if (savedConcerns) {
                try { userConcerns = JSON.parse(savedConcerns); }
                catch (e) { console.error("Error parsing saved concerns:", e); userConcerns = []; }
            }

            const savedRegion = localStorage.getItem('frommAiUserRegion');
            if (savedRegion) {
                userRegion = savedRegion;
                userRegionSelect.value = userRegion; // Set select value
            }

            const savedSection = localStorage.getItem('frommAiActiveSection') || 'myAIMentor';
            translateUI();
            showSection(savedSection);
        }

        document.addEventListener('DOMContentLoaded', initializeApp);
    </script>
</body>
</html>
